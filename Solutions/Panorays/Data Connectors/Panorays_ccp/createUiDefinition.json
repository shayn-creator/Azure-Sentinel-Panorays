{
  "$schema": "https://schema.management.azure.com/schemas/0.2.0-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.2.0-preview",
  "parameters": {
    "config": {
      "isWizard": false,
      "basics": {
        "description": "<img src=\"https://panorays.com/wp-content/uploads/2022/07/panorays-logo.svg\" width=\"75px\" height=\"75px\">\n\n**Note:** Please refer to the following before installing the solution: \n\n• Review the solution [Release Notes](https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/Panorays/ReleaseNotes.md)\n\n • There may be [known issues](https://aka.ms/sentinelsolutionsknownissues) pertaining to this Solution, please refer to them before installing.\n\nThe [Panorays](https://www.panorays.com/) solution provides ability to bring Panorays company findings to your Microsoft Sentinel Workspace to inform and to examine potential security risks\n\n**Data Connectors:** 1\n\n[Learn more about Microsoft Sentinel](https://aka.ms/azuresentinel) | [Learn more about Solutions](https://aka.ms/azuresentinelsolutionsdoc)",
        "subscription": {
          "resourceProviders": [
            "Microsoft.OperationsManagement/solutions",
            "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "Microsoft.Insights/workbooks",
            "Microsoft.Logic/workflows"
          ]
        },
        "location": {
          "metadata": {
            "hidden": "Hiding location, we get it from the log analytics workspace"
          },
          "visible": false
        },
        "resourceGroup": {
          "allowExisting": true
        }
      }
    },
	"basics": [
      {
        "name": "getLAWorkspace",
        "type": "Microsoft.Solutions.ArmApiControl",
        "toolTip": "This filters by workspaces that exist in the Resource Group selected",
        "condition": "[greater(length(resourceGroup().name),0)]",
        "request": {
          "method": "GET",
          "path": "[concat(subscription().id,'/providers/Microsoft.OperationalInsights/workspaces?api-version=2020-08-01')]"
        }
      },
      {
        "name": "workspace",
        "type": "Microsoft.Common.DropDown",
        "label": "Workspace",
        "placeholder": "Select a workspace",
        "toolTip": "This dropdown will list only workspace that exists in the Resource Group selected",
        "constraints": {
          "allowedValues": "[map(filter(basics('getLAWorkspace').value, (filter) => contains(toLower(filter.id), toLower(resourceGroup().name))), (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.name, '\"}')))]",
          "required": true
        },
        "visible": true
      }
    ],
    "steps": [
      {
        "name": "configuration",
        "label": "Configuration",
        "subLabel": {
          "preValidation": "API Details",
          "postValidation": "Done"
        },
        "bladeTitle": "Panorays Configuration",
        "elements": [
          {
            "name": "instructions",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "Please provide your Panorays API details. These will be used to configure the Data Connector automatically."
            }
          },
          {
            "name": "panoraysAPIBaseUrl",
            "type": "Microsoft.Common.TextBox",
            "label": "Panorays API Base URL",
            "toolTip": "The base URL for the Panorays API.",
            "defaultValue": "https://api.panoraysapp.com",
            "constraints": {
              "required": true
            }
          },
          {
            "name": "apitoken",
            "type": "Microsoft.Common.TextBox",
            "label": "API Token",
            "toolTip": "Your Panorays API Token.",
            "placeholder": "Paste your API Token here",
            "constraints": {
              "required": true
            },
            "osPlatform": "Linux",
            "visible": true,
            "password": true
          }
        ]
      }
    ],
    "outputs": {
      "workspace-location": "[first(map(filter(basics('getLAWorkspace').value, (filter) => and(contains(toLower(filter.id), toLower(resourceGroup().name)),equals(filter.name,basics('workspace')))), (item) => item.location))]",
      "location": "[location()]",
      "workspace": "[basics('workspace')]",
      "resourceGroupName": "[resourceGroup().name]",
      "subscription": "[subscription().subscriptionId]",
      "panoraysAPIBaseUrl": "[steps('configuration').panoraysAPIBaseUrl]",
      "apitoken": "[steps('configuration').apitoken]"
    }
  }
}